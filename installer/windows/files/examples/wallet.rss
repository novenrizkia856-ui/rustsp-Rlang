// wallet.rss - RustS+ Wallet Example
// Demonstrates Effect Ownership and Pure Functions

struct Wallet {
    id u32
    balance i64
}

enum Transaction {
    Deposit { amount i64 }
    Withdraw { amount i64 }
}

// Pure function - no effects declared, no side effects allowed
fn apply_tx(w Wallet, tx Transaction) Wallet {
    match tx {
        Transaction::Deposit { amount } {
            Wallet {
                id = w.id
                balance = w.balance + amount
            }
        }
        Transaction::Withdraw { amount } {
            Wallet {
                id = w.id
                balance = w.balance - amount
            }
        }
    }
}

// Effectful function - io declared because it uses println
fn print_balance(w &Wallet) effects(io) {
    println("Wallet #{}: Balance = {}", w.id, w.balance)
}

fn main() effects(io) {
    // Create initial wallet
    wallet = Wallet { id = 1, balance = 100 }
    print_balance(&wallet)
    
    // Apply deposit transaction
    tx1 = Transaction::Deposit { amount = 50 }
    wallet = apply_tx(wallet, tx1)
    println("After deposit:")
    print_balance(&wallet)
    
    // Apply withdrawal transaction
    tx2 = Transaction::Withdraw { amount = 30 }
    wallet = apply_tx(wallet, tx2)
    println("After withdrawal:")
    print_balance(&wallet)
}